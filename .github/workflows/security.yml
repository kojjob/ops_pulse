name: Security Audit

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '0 0 * * 0' # Run weekly on Sundays

permissions:
  contents: read

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Elixir
      uses: erlef/setup-beam@v1
      with:
        elixir-version: '1.15.7'
        otp-version: '26.1'

    - name: Install dependencies
      run: mix deps.get

    - name: Run Sobelow (Static Analysis)
      run: mix sobelow --config .sobelow-conf || echo "Sobelow failed or not configured"

    - name: Deps Security Audit
      run: mix hex.audit && (mix deps.audit || echo "mix deps.audit not available")
